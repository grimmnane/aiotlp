<!--index.wxml-->
<view class="container {{ showShare ? 'container-height' : ''}}">
  <swiper autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}">
    <block wx:for="{{bannerList}}" wx:key="index">
      <swiper-item >
        <image class="banner"  mode="{{bannerMode}}" src="{{item.path}}"></image>
      </swiper-item>
    </block>
  </swiper>
  <van-notice-bar left-icon="volume-o" text="在代码阅读过程中人们说脏话的频率是衡量代码质量的唯一标准。"/>
  

  <navigator class="" target="" url="/pages/share/secret" open-type="navigate">
    去隐私页
  </navigator>
  <!--我的设备-->
  <view>
    <view class="title primary-title" bindtap = "toggleDeviceHidden">
      <view class="name">我的设备（{{deviceList.length}}）</view>
      <view class="btn-group">
        <view class="mr-30 plus-btn"   catchtap="toAddPage">
          <van-icon name="plus" color="#07c163" />
        </view>
        <view class="arrow {{deviceHidden ? '' : 'rotate'}}" >
          <van-icon name="arrow-down" color="#07c163" />
        </view>
      </view>
    </view>
    <view class="list plr-18" hidden="{{deviceHidden}}">
      <view wx:if="{{!deviceList.length && deviceLoaded}}" class="empty-wrap">
        <van-empty class="custom-image" image="https://img.yzcdn.cn/vant/custom-empty-image.png" description="暂无数据"/>
      </view>
      <view wx:else>
        <view class="item mt-18" wx:for="{{deviceList}}" wx:key="index"  data-code="{{item.code}}" bindtap="toDeviceDetailPage">
          <view>
            <view class="img-wrap">
              <image class="banner"  mode="{{bannerMode}}" src="{{item.path}}"></image>
            </view>
          </view>
          <view class="item-content">
              <view class="detail-item">
                  <view class="label label_device">名称：</view>
                  <view class="value value_device">{{item.name}}</view>
              </view>
              <view class="detail-item">
                  <view class="label label_device">编号：</view>
                  <view class="value value_device">{{item.code}}</view>
              </view>
              <view class="detail-item">
                <view class="label label_device">类型：</view>
                <view class="value value_device">{{item.typeName}}</view>
              </view>
              <view class="detail-item">
                <view class="label label_device">电量：</view>
                <view class="value value_device">{{item.battery}}</view>
              </view>
          </view>
        </view>
      </view>
    </view>
  </view>
  <view>
    <view class="title primary-title" >
      <view class="name">我的区域（{{allSensorCount}}）</view>
      <view >
        <view wx:if="{{showShare}}"  bindtap = "cancelShare">
          <van-icon name="cross"  size="20px" color="#07c163" /><span class="cancel-share">取消分享</span>
        </view>
        <view  wx:else bindtap="toggleShare">
          <van-icon name="share-o" size="20px" color="#07c163"/>
        </view>
      </view>
    </view>
  </view>
  <view class="area-container plr-18">
    <view class="loading-wrap" wx:if="{{areaLoading}}" >
      <van-loading size="24px">加载中...</van-loading>
    </view>
    <view wx:if="{{!areaList.length && !areaLoading}}" class="empty-wrap">
      <van-empty class="custom-image" image="https://img.yzcdn.cn/vant/custom-empty-image.png" description="暂无数据"/>
    </view>
    <view wx:else>
      <view  wx:for="{{areaList}}" wx:key="index" >
        <view class="">
          <view class="flex">
            <view class="mr-10" wx:if="{{showShare && item.list.length}}">
              <van-checkbox custom-class="title-checkbox" value="{{ item.isChecked }}" data-index="{{index}}" data-type="1" bind:change="onChange"></van-checkbox>
            </view>
            <view class="title secondary-title flex-1" data-index="{{index}}" bindtap = "toggleShowItem">
              <view class="name">{{item.areaName}}（{{item.list.length}}）</view>
              <view class="arrow {{!item.isShow ? '' : 'rotate'}}" >
                <van-icon name="arrow-down" color="#07c163" />
              </view>
            </view>
          </view>
          <view class="list" wx:if="{{item.isShow}}">
            <view wx:if="{{!item.list.length && !areaLoading}}" class="empty-wrap">
              <van-empty class="custom-image" image="https://img.yzcdn.cn/vant/custom-empty-image.png" description="暂无数据"/>
            </view>
            <view wx:else>
              <view class="flex item-wrap" wx:for="{{item.list}}" wx:for-item="child" wx:for-index="_index" wx:key="_index"  data-id="{{child.sensorId}}" bindtap = "toDetailPage">
                <view class="mr-10" wx:if="{{showShare}}">
                  <van-checkbox value="{{ child.isChecked }}" data-index="{{_index}}" data-parentIndex="{{index}}" data-type="2" bind:change="onChange"></van-checkbox>
                </view>
                <view class="flex-1 item">
                  <view class="item-thumb">
                    <view class="img-wrap">
                      <image class="banner2"  mode="{{bannerMode}}" src="data:image/png;base64,{{child.url}}"></image>
                    </view>
                  </view>
                  <view class="item-content">
                      <view class="detail-item">
                          <view class="label">设备名称：</view>
                          <view class="value">{{child.deviceName}}</view>
                      </view>
                      <view class="detail-item">
                          <view class="label">传感器名称：</view>
                          <view class="value">{{child.sensorName}}</view>
                      </view>
                      <view class="detail-item">
                        <view class="label">类型：</view>
                        <view class="value">{{child.deviceTypeName}}</view>
                      </view>
                      <view class="detail-item" wx:if="{{child.deviceData}}">
                        <view class="label">{{child.unitNameCN}}：</view>
                        <view class="value">{{child.deviceData}}</view>
                      </view>
                       <view class="detail-item">
                        <view class="label">时间：</view>
                        <view class="value">{{child.date}}</view>
                      </view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>


    <view class="shareBar flex flex-sb" wx:if="{{showShare}}">
      <van-checkbox custom-class="title-checkbox" value="{{ allChecked }}" bind:change="changeAllChecked">全选</van-checkbox>
      <view class="flex">
        <view class="flex checked">已选中:<view class="num">{{checkedSensorIds.length}}</view> 条</view>
        <van-button type="primary" bind:click="openShare">去分享</van-button>
      </view>
    </view>
  </view>

  <van-toast id="van-toast" />
  <van-dialog id="van-dialog" />
  <!--  -->
  <van-share-sheet
    show="{{ choseShare }}"
    title="我的分享"
    options="{{ options }}"
    bind:select="selectShare"
    bind:close="closeShare"
  />

</view>
